# Diagrama de Arquitectura - Mรณdulo de Autenticaciรณn

## ๐ Flujo de Datos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         CAPA DE UI                              โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโโ             โ
โ  โ   Activity/    โ          โ AuthViewModelNew โ             โ
โ  โ   Fragment     โโโโโโโโโโโโค  (StateFlow)     โ             โ
โ  โ                โ          โ                  โ             โ
โ  โโโโโโโโโโฌโโโโโโโโ          โโโโโโโโโโฌโโโโโโโโโโ             โ
โ           โ                           โ                        โ
โ           โ                  โโโโโโโโโโผโโโโโโโโโโ             โ
โ           โโโโโโโโโโโโโโโโโโโบโGoogleSignInHelperโ             โ
โ                              โโโโโโโโโโโโโโโโโโโโ             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                     โ
                                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE DOMINIO                            โ
โ                    (Sin dependencias)                           โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  โ              USE CASES (Casos de Uso)            โ          โ
โ  โ                                                  โ          โ
โ  โ  โข SignInWithEmailUseCase                        โ          โ
โ  โ  โข RegisterWithEmailUseCase                      โ          โ
โ  โ  โข SignInWithGoogleUseCase                       โ          โ
โ  โ  โข SignOutUseCase                                โ          โ
โ  โ  โข GetCurrentUserUseCase                         โ          โ
โ  โ  โข ValidateSessionUseCase                        โ          โ
โ  โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ                       โ                                         โ
โ                       โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  โ     AuthRepository (Interface)                   โ          โ
โ  โ                                                  โ          โ
โ  โ  + signInWithEmail()                             โ          โ
โ  โ  + registerWithEmail()                           โ          โ
โ  โ  + signInWithGoogle()                            โ          โ
โ  โ  + signOut()                                     โ          โ
โ  โ  + getCurrentUser()                              โ          โ
โ  โ  + isSessionValid()                              โ          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  โ           User (Entidad de Dominio)              โ          โ
โ  โ                                                  โ          โ
โ  โ  - id: String                                    โ          โ
โ  โ  - email: String?                                โ          โ
โ  โ  - displayName: String?                          โ          โ
โ  โ  - photoUrl: String?                             โ          โ
โ  โ  - isEmailVerified: Boolean                      โ          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                     โ
                                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       CAPA DE DATOS                             โ
โ                   (Implementaciรณn)                              โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  โ        AuthRepositoryImpl                        โ          โ
โ  โ      (Implementa AuthRepository)                 โ          โ
โ  โ                                                  โ          โ
โ  โ  - remoteDataSource                              โ          โ
โ  โ  - localDataSource                               โ          โ
โ  โ  - validator                                     โ          โ
โ  โ  - errorMapper                                   โ          โ
โ  โ  - userService                                   โ          โ
โ  โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ          โ
โ            โ                    โ                               โ
โ            โผ                    โผ                               โ
โ  โโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ                   โ
โ  โRemoteAuthDataSrc โ  โLocalAuthDataSrc  โ                   โ
โ  โ                  โ  โ                  โ                   โ
โ  โ - FirebaseAuth   โ  โ - SessionStorage โ                   โ
โ  โ                  โ  โ                  โ                   โ
โ  โโโโโโโโโโฌโโโโโโโโโโ  โโโโโโโโโโฌโโโโโโโโโโ                   โ
โ           โ                     โ                              โ
โ           โผ                     โผ                              โ
โ  โโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ                   โ
โ  โ  Firebase Auth   โ  โ  SessionStorage  โ                   โ
โ  โ  (External)      โ  โ   (Interface)    โ                   โ
โ  โโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโฌโโโโโโโโโโ                   โ
โ                                 โ                              โ
โ                                 โผ                              โ
โ                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ                    โSharedPreferencesSession  โ               โ
โ                    โ       Storage            โ               โ
โ                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  โ              COMPONENTES AUXILIARES              โ          โ
โ  โ                                                  โ          โ
โ  โ  โข UserMapper: FirebaseUser โ User               โ          โ
โ  โ  โข AuthValidator: Validaciรณn de entrada          โ          โ
โ  โ  โข AuthErrorMapper: Mapeo de errores             โ          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo de una Operaciรณn de Sign In

```
1. Usuario ingresa email y password
   โ
   โผ
2. Activity/Fragment llama โ authViewModel.signInWithEmail(email, password)
   โ
   โผ
3. ViewModel llama โ signInWithEmailUseCase(email, password)
   โ
   โผ
4. Use Case llama โ authRepository.signInWithEmail(email, password)
   โ
   โผ
5. AuthRepositoryImpl:
   โ
   โโโบ AuthValidator.validateLoginCredentials() โ Valida entrada
   โ   โ
   โ   โโโบ Si invรกlido: AuthException
   โ
   โโโบ RemoteAuthDataSource.signInWithEmail() โ Llama a Firebase
   โ   โ
   โ   โโโบ FirebaseAuth.signInWithEmailAndPassword()
   โ
   โโโบ UserMapper.toDomain(firebaseUser) โ Convierte a User
   โ
   โโโบ LocalAuthDataSource.saveSession(user) โ Guarda en local
       โ
       โโโบ SessionStorage.saveSession(user)
           โ
           โโโบ SharedPreferences
   โ
   โผ
6. Result<User> regresa al ViewModel
   โ
   โผ
7. ViewModel actualiza AuthState
   โ
   โผ
8. UI observa StateFlow y actualiza la vista
```

## ๐ฏ Principios SOLID en la Arquitectura

### Single Responsibility Principle (SRP)
```
RemoteAuthDataSource  โ Solo comunicaciรณn con Firebase
LocalAuthDataSource   โ Solo almacenamiento local
AuthValidator         โ Solo validaciรณn
AuthErrorMapper       โ Solo mapeo de errores
UserMapper            โ Solo conversiรณn de entidades
SessionStorage        โ Solo gestiรณn de sesiรณn
```

### Dependency Inversion Principle (DIP)
```
            โโโโโโโโโโโโโโโโโโโโ
            โ AuthViewModel    โ (Alto nivel)
            โโโโโโโโโโฌโโโโโโโโโโ
                     โ depende de
                     โผ
            โโโโโโโโโโโโโโโโโโโโ
            โ   Use Cases      โ (Alto nivel)
            โโโโโโโโโโฌโโโโโโโโโโ
                     โ depende de
                     โผ
            โโโโโโโโโโโโโโโโโโโโ
            โ AuthRepository   โ (Abstracciรณn)
            โ  (Interface)     โ
            โโโโโโโโโโฌโโโโโโโโโโ
                     โ implementa
                     โผ
            โโโโโโโโโโโโโโโโโโโโ
            โAuthRepositoryImplโ (Bajo nivel)
            โโโโโโโโโโฌโโโโโโโโโโ
                     โ depende de
                     โผ
      โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
      โ                             โ
      โผ                             โผ
โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโ
โ RemoteData   โ         โ   LocalData      โ
โ   Source     โ         โ    Source        โ
โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโ
```

### Interface Segregation Principle (ISP)
```
โโโโโโโโโโโโโโโโโโโโโโ
โ  AuthRepository    โ โ Operaciones de autenticaciรณn
โโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโ
โ  SessionStorage    โ โ Operaciones de sesiรณn
โโโโโโโโโโโโโโโโโโโโโโ

(Interfaces separadas y especรญficas)
```

## ๐ฆ Mรณdulos y Dependencias

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            AuthModule (DI)                  โ
โ                                             โ
โ  provideAuthRepository()                    โ
โ  provideRemoteAuthDataSource()              โ
โ  provideLocalAuthDataSource()               โ
โ  provideAuthValidator()                     โ
โ  provideAuthErrorMapper()                   โ
โ  provideSessionStorage()                    โ
โ  provideGoogleSignInHelper()                โ
โ  provideUse Cases...()                      โ
โ  provideAuthViewModelFactory()              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐งช Testing

### Capas Testeables Independientemente

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Use Cases Tests                        โ
โ (Mock AuthRepository)                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Repository Tests                       โ
โ (Mock DataSources, Validator, Mapper)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ DataSource Tests                       โ
โ (Mock Firebase/SharedPreferences)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ViewModel Tests                        โ
โ (Mock Use Cases)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Ventajas Clave

1. **Separaciรณn de Capas**: Cada capa tiene su responsabilidad clara
2. **Independencia del Framework**: El dominio no conoce Firebase ni Android
3. **Testeable**: Todas las dependencias son inyectables
4. **Mantenible**: Cรณdigo organizado y fรกcil de entender
5. **Escalable**: Fรกcil agregar nuevas funcionalidades
6. **Reutilizable**: Use cases pueden usarse en diferentes contextos
7. **Sin Cรณdigo Duplicado**: DRY aplicado consistentemente
